<link rel="stylesheet" href="/css/button.css">
{% macro button(label, type="submit", frontIcon="", form="",  backIcon="", primary=true, disabled=false, size="", extra_attrs="") %}
  {% if primary %}
    {% set class_name = "button primary-button" %}
  {% else %}
    {% set class_name = "button secondary-button" %}
  {% endif %}
  {% if disabled %}
    {% set class_name = class_name ~ " is-disabled" %}
  {% endif %}
  {% if size == "small" %}
    {% set class_name = class_name ~ " button-small" %}
  {% elif size == "big" %}
    {% set class_name = class_name ~ " button-big" %}
  {% endif %}

  <button type="{{ type }}" form="{{ form }}" class="{{ class_name }}" {{ extra_attrs | safe }} {% if disabled %}disabled{% endif %}>
    {% if frontIcon != "" %}
        <span class="front-arrow">{{ frontIcon | safe }}</span>
    {% endif %}
    <span class="button-text">{{ label }}</span>
    {% if backIcon != "" %}
        <span class="back-arrow">{{ backIcon | safe }}</span>
    {% endif %}
  </button>
{% endmacro %}

{% macro stepper(current_step=1) %}
<div class="stepper-container">
  <div class="stepper">
    {% set steps = [
      "Select Job",
      "Fill Application",
      "Confirm Queue",
      "Review and Vote",
      "Leaderboards"
    ] %}
    {% for i in range(end=steps | length) %}
      {% if i + 1 == current_step %}
        {% set step_class = "step active" %}
      {% else %}
        {% set step_class = "step" %}
      {% endif %}
      {% if i + 1 == 1 %}
        <div class="{{ step_class }}" onclick="window.location.href='/jobs'" style="cursor: pointer;">
      {% elif i + 1 == 3 %}
        <div class="{{ step_class }}" onclick="window.location.href='/queue'" style="cursor: pointer;">
      {% elif i + 1 == 5 %}
        <div class="{{ step_class }}" onclick="window.location.href='/leaderboard'" style="cursor: pointer;">
      {% elif i + 1 == 4 %}
        <div class="{{ step_class }}" id="step-4-container">
      {% else %}
        <div class="{{ step_class }}">
      {% endif %}
        {% if i + 1 == 4 %}
          <div style="display: flex; justify-content: space-between; width: 100%;">
            <div style="display: flex;">
              <div class="step-number">{{ i + 1 }}:</div>
              <div class="step-label">{{ steps[i] }}</div>
            </div>
            <div id="step-4-status" style="display: flex; align-items: center; font-size: 12px; padding-right: 8px;"></div>
          </div>
        {% else %}
          <div class="step-number">{{ i + 1 }}:</div>
          <div class="step-label">{{ steps[i] }}</div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>

<script>
// Step 4 timer functionality
document.addEventListener('DOMContentLoaded', function() {
  const step4Status = document.getElementById('step-4-status');
  if (!step4Status) return;

  function updateStep4Status() {
    try {
      const eventTimestamp = localStorage.getItem('eventTimestamp');
      if (!eventTimestamp) return;

      const eventTime = parseInt(eventTimestamp, 10);
      const currentTime = Math.floor(Date.now() / 1000);
      
      if (currentTime >= eventTime) {
        // Event is live
        step4Status.innerHTML = '<span style="color: #f5c842; font-weight: bold;">Live</span>';
      } else {
        // Event is in the future, show countdown
        const remaining = eventTime - currentTime;
        const hours = Math.floor(remaining / 3600);
        const minutes = Math.floor((remaining % 3600) / 60);
        const seconds = remaining % 60;
        
        const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        const step4Container = document.getElementById('step-4-container');
        const computedStyle = step4Container ? getComputedStyle(step4Container) : null;
        
        if (computedStyle) {
          step4Status.style.color = computedStyle.color;
          step4Status.style.fontFamily = computedStyle.fontFamily;
          step4Status.style.fontSize = computedStyle.fontSize;
          step4Status.style.fontWeight = computedStyle.fontWeight;
          step4Status.style.opacity = 0.5;
        }
        
        step4Status.textContent = `Unlocks: ${timeString}`;
      }
    } catch (error) {
      console.warn('Error updating step 4 status:', error);
    }
  }

  // Update immediately and then every second
  updateStep4Status();
  setInterval(updateStep4Status, 1000);
});
</script>
{% endmacro %}



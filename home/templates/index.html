{% import "macros/components.html" as components %}
{% import "macros/icons.html" as icons %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Battalion</title>
  <link rel="stylesheet" href="/css/home_page.css" />
  <link rel="stylesheet" href="/css/button.css">
</head>
<body>
  <div class="container-background">
    <div class="top-section">
      <div class="logo-header">
        <h1 class="logo">Battalion</h1>
        <div class="tagline">A Battalion Of Product Designers. And Engineers.</div>
      </div>
        
      <section class="sidebar-card">
        <h2>How Battalion Works</h2>
        <p>
          Battalion is an ATS platform built to provide applicants with actionable feedback from industry professionals.
          Feedback is done in 2-minute sessions, and a total of 20 applicants are selected from this process.
        </p>
        {% set discord_icon_svg = icons::discord_icon() %}
        {{ components::button(
          label="JOIN DISCORD",
          type="button",
          primary=false,
          size="big",
          backIcon=discord_icon_svg,
          extra_attrs='onclick="openDiscordInvite()"'
        ) }}

        <ol class="steps">
          <li>Select a job link</li>
          <li>Fill out the application</li>
          <li>Join the stream</li>
          <li>Review, vote and give feedback</li>
          <li>Compare leaderboard scores</li>
        </ol>
        <div class="event-info">
          <p>Next Event: <span class="timer" id="countdown"></span></p>
            <!-- <form id="resume-form" action="/jobs" method="get"> -->
            <input 
              type="hidden" 
              id="event-id-hidden" 
              name="event_id" 
              value="{% if event_options and event_options[0] %}{{ event_options[0].value }}{% endif %}" />
            {{ components::button(label="BEGIN APPLICATION", 
              form="resume-form", 
              type="submit", 
              primary=false, 
              size="big",
              extra_attrs='onclick="beginApplication()"'
            ) }}
        </div>
      </section>
    </div>
  </div>
  <script>
    // const eventTimestamp = {{ time_stamp }}; // Injected by Tera as UNIX timestamp , uncomment in when you get the BE working
    const nowPlusTwoHours = Math.floor(Date.now() / 1000) + 0.05 * 3600; // current time + 3 minutes
    const countdownEl = document.getElementById("countdown");
    function formatTime(seconds) {
      const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
      const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
      const secs = String(seconds % 60).padStart(2, '0');
      return `${hrs}:${mins}:${secs}`;
    }
    function updateCountdown() {
      const now = Math.floor(Date.now() / 1000); // current UNIX timestamp in seconds
      const remaining = nowPlusTwoHours - now;

      if (remaining > 0) {
        countdownEl.textContent = formatTime(remaining);
      } else {
        countdownEl.textContent = "Live Now!";
        clearInterval(timerInterval);
      }
    }
    updateCountdown();
    const timerInterval = setInterval(updateCountdown, 1000);

    function openDiscordInvite() {
      window.open("https://discord.com/invite/XJ2PBd3F", "_blank");
    }
    function beginApplication() {
      const eventId = document.getElementById("event-id-hidden").value;
      window.location.href = `/jobs`;
    }
  </script>
</body>
</html>

{% import "macros/components.html" as components %}
{% import "macros/icons.html" as icons %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Application Portal</title>
    <link rel="stylesheet" href="/css/job_section.css" />
    <link rel="stylesheet" href="/css/button.css">
    <link rel="stylesheet" href="/css/stepper.css">
</head>
<body>
    <!-- Horizontal Stepper -->
    <div class="container-background-jobs">
        <div class="grid-container">
            <div class="container-wrapper">
                {{ components::stepper(current_step=1) }}
                <!-- Main Content -->
                <div class="main-container">
                    <div class="left-panel">
                        <div class="left-panel-wrapper">
                            <div class="left-panel-child">
                                <div class="back-button" role="button" tabindex="0" onclick="history.back()">
                                    {{ icons::back_icon() | safe }}
                                </div>
                                <h1 class="page-title">Select Your Session</h1>
                            </div>
                            <p class="page-subtitle">
                                Select a session to apply for. Be mindful of your session's time zone to assure you can attend.
                            </p>
                        </div>

                        <div class="job-list-wrapper">
                            <div class="job-list">
                                {% for job in jobs %}
                                    <div class="job-card{% if loop.index0 == 0 %} selected{% endif %}">
                                        <div class="job-content">
                                            <h3 class="job-title">{{ job.title }}</h3>
                                            <div class="job-details">
                                                <div class="job-meta">{{ job.level }}</div>
                                                <div class="job-meta">See Job Posting</div>
                                                <div class="job-meta">{{ job.team }} Applicants</div>
                                            </div>
                                        </div>
                                        <div class="company-icon">üçé</div>
                                    </div>
                                {% endfor %}
                            </div>

                            <div class="job-footer">
                                <form id="resume-form" action="/apply" method="get"></form>
                                    <div style="width: 50%">
                                        {{ components::button(label="APPLY NOW", form="resume-form", type="submit", primary=true, size="big") }}
                                    </div>
                                </form>
                            </div>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Job card selection functionality
        const jobCards = document.querySelectorAll('.job-card');
        const resumeForm = document.getElementById('resume-form');
        let selectedJobId = null;

        jobCards.forEach((card, index) => {
            card.addEventListener('click', () => {
                jobCards.forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                
                // Store the selected job ID (you'll need to add data-job-id to your job cards)
                selectedJobId = card.dataset.jobId || index + 1; // fallback to index if no job ID
                
                // Update form action with the selected job ID
                resumeForm.action = `/apply/${selectedJobId}`;
            });
        });

        // Initialize with first job selected
        if (jobCards.length > 0) {
            selectedJobId = jobCards[0].dataset.jobId || 1;
            resumeForm.action = `/apply/${selectedJobId}`;
        }

        // Add form submission handler to store job_id in localStorage
        resumeForm.addEventListener('submit', function(e) {
            if (selectedJobId) {
                localStorage.setItem('selectedJobId', selectedJobId);
            }
        });

        // Stepper functionality
        const steps = document.querySelectorAll('.step');
        let currentStep = 0;

        function updateStepper() {
            steps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < currentStep) {
                    step.classList.add('completed');
                } else if (index === currentStep) {
                    step.classList.add('active');
                }
            });
        }

        function applyButtonClick() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                updateStepper();

                const titles = [
                    'Select Your Session',
                    'Fill Your Application',
                    'Confirm Your Queue Position',
                    'Review and Vote',
                    'View Leaderboards'
                ];
                const subtitles = [
                    'Select a session to apply for. Be mindful of your session\'s time zone to ensure you can attend.',
                    'Please fill out your application details carefully.',
                    'Confirm your position in the application queue.',
                    'Review other applications and cast your votes.',
                    'See how you rank against other applicants.'
                ];

                document.querySelector('.page-title').textContent = titles[currentStep];
                document.querySelector('.page-subtitle').textContent = subtitles[currentStep];

                const applyButton = document.querySelector('.apply-button');
                if (currentStep === steps.length - 1) {
                    applyButton.textContent = 'COMPLETE';
                    applyButton.style.background = '#4caf50';
                }
            }
        }

        // Back button functionality
        document.querySelector('.back-button').addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                updateStepper();
                
                const titles = [
                    'Select Your Session',
                    'Application Page',
                    'Confirm Your Queue Position',
                    'Review and Vote',
                    'View Leaderboards'
                ];
                
                const subtitles = [
                    'Select a session to apply for. Be mindful of your session\'s time zone to ensure you can attend.',
                    'Please fill out your application details carefully.',
                    'Confirm your position in the application queue.',
                    'Review other applications and cast your votes.',
                    'See how you rank against other applicants.'
                ];
                
                document.querySelector('.page-title').textContent = titles[currentStep];
                document.querySelector('.page-subtitle').textContent = subtitles[currentStep];
                
                const applyButton = document.querySelector('.apply-button');
                if (applyButton) {
                    applyButton.textContent = 'APPLY NOW';
                    applyButton.style.background = '#ff6b35';
                }
            }
        });

        // Initialize stepper
        updateStepper();
    </script>
</body>
</html>